# Caddy configuration for shftsecure Mini App
# 
# Обслуживает:
# - app.shftsecure.one → Mini App (frontend + API)

app.shftsecure.one {
    # Вебхуки (доступны публично)
    handle /webhook/* {
        reverse_proxy localhost:8080
    }
    
    # API проксируем на бота (порт 8080) - СНАЧАЛА!
    handle /api/* {
        reverse_proxy localhost:8080
    }
    
    # Frontend (статика из mini-app/frontend/dist)
    handle {
        root * /srv/mini-app
        try_files {path} /index.html
        file_server
    }
    
    # Заголовки безопасности
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options SAMEORIGIN
        Referrer-Policy strict-origin-when-cross-origin
    }
    
    # Сжатие
    encode gzip
    
    # Логи
    log {
        output file /var/log/caddy/app.log
        format console
    }
}

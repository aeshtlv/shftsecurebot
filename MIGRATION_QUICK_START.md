# üöÄ –ö—Ä–∞—Ç–∫–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏

## ü§î –ö–∞–∫–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π –≤—ã–±—Ä–∞—Ç—å?

### –°—Ü–µ–Ω–∞—Ä–∏–π A: –°–º–µ–Ω–∞ –¥–æ–º–µ–Ω–∞ (—Ç–∞ –∂–µ –ø–∞–Ω–µ–ª—å)
**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:** [DOMAIN_CHANGE_GUIDE.md](DOMAIN_CHANGE_GUIDE.md)

**–ö–æ–≥–¥–∞:**
- ‚úÖ –ú–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–æ–º–µ–Ω
- ‚úÖ –¢–∞ –∂–µ –ø–∞–Ω–µ–ª—å Remnawave
- ‚úÖ –¢–æ—Ç –∂–µ —Å–µ—Ä–≤–µ—Ä
- ‚úÖ UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º–∏

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –û–±–Ω–æ–≤–∏—Ç—å `Caddyfile` (–Ω–æ–≤—ã–π –¥–æ–º–µ–Ω)
2. –û–±–Ω–æ–≤–∏—Ç—å `.env` (–µ—Å–ª–∏ –º–µ–Ω—è–µ—Ç—Å—è API URL)
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Caddy –∏ –±–æ—Ç
4. –ö–æ–Ω—Ñ–∏–≥–∏ –æ–±–Ω–æ–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–í—Ä–µ–º—è:** 15-30 –º–∏–Ω—É—Ç

---

### –°—Ü–µ–Ω–∞—Ä–∏–π B: –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤—É—é –ø–∞–Ω–µ–ª—å
**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:** [PANEL_MIGRATION_GUIDE.md](PANEL_MIGRATION_GUIDE.md)

**–ö–æ–≥–¥–∞:**
- ‚úÖ –ù–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä
- ‚úÖ –ù–æ–≤–∞—è –ø–∞–Ω–µ–ª—å Remnawave
- ‚úÖ –ù–æ–≤—ã–µ UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ù—É–∂–µ–Ω –ø–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —Å—Ç–∞—Ä–æ–π –ø–∞–Ω–µ–ª–∏
2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –Ω–æ–≤—É—é –ø–∞–Ω–µ–ª—å
3. –û–±–Ω–æ–≤–∏—Ç—å UUID –≤ –ë–î –±–æ—Ç–∞
4. –£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–í—Ä–µ–º—è:** 2-4 —á–∞—Å–∞

---

## ‚ö°Ô∏è –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –°–º–µ–Ω–∞ –¥–æ–º–µ–Ω–∞

```bash
# 1. –õ–æ–∫–∞–ª—å–Ω–æ: –æ–±–Ω–æ–≤–∏—Ç—å Caddyfile
sed -i 's/app.old-domain.com/app.new-domain.com/' caddy/Caddyfile
git add caddy/Caddyfile
git commit -m "Update domain"
git push

# 2. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ: –æ–±–Ω–æ–≤–∏—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
ssh root@SERVER_IP
cd /opt/shftsecurebot
git pull
nano .env  # –ò–∑–º–µ–Ω–∏—Ç—å API_BASE_URL –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
docker compose down
docker compose up -d --build
cd /opt/caddy
docker compose down
docker compose up -d
```

---

## ‚ö°Ô∏è –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –ú–∏–≥—Ä–∞—Ü–∏—è –ø–∞–Ω–µ–ª–∏

### –í–∞—Ä–∏–∞–Ω—Ç A: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –≠–∫—Å–ø–æ—Ä—Ç (–ª–æ–∫–∞–ª—å–Ω–æ)
cd scripts
export OLD_API_TOKEN="..."
export OLD_PANEL_URL="https://panel.old-domain.com"
./export_users.sh

# 2. –ò–º–ø–æ—Ä—Ç (–ª–æ–∫–∞–ª—å–Ω–æ)
export NEW_API_TOKEN="..."
export NEW_PANEL_URL="https://panel.new-domain.com"
export EXTERNAL_SQUAD_UUID="..."
export INTERNAL_SQUAD_UUIDS="uuid1,uuid2"
python3 import_users.py users_export.json

# 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
scp uuid_mapping.json root@SERVER_IP:/opt/shftsecurebot/scripts/
ssh root@SERVER_IP
cd /opt/shftsecurebot
docker compose down
python3 scripts/update_bot_database.py scripts/uuid_mapping.json data/bot_data.db

# 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞ (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
nano .env  # API_BASE_URL, API_TOKEN
docker compose up -d --build

# 5. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–≤ –±–æ—Ç–µ –æ—Ç –∞–¥–º–∏–Ω–∞)
/migrate_notify_confirm
```

### –í–∞—Ä–∏–∞–Ω—Ç B: –†—É—á–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (–ø—Ä–æ—Å—Ç–∞—è)

```bash
# 1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –±–æ—Ç–∞
ssh root@SERVER_IP
cd /opt/shftsecurebot

# 2. –°–±—Ä–æ—Å–∏—Ç—å UUID
docker compose down
cp data/bot_data.db data/bot_data.db.backup
sqlite3 data/bot_data.db "UPDATE bot_users SET remnawave_user_uuid = NULL;"

# 3. –û–±–Ω–æ–≤–∏—Ç—å .env
nano .env  # API_BASE_URL, API_TOKEN

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
docker compose up -d --build

# 5. –í—ã–¥–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏ (–≤ –±–æ—Ç–µ –æ—Ç –∞–¥–º–∏–Ω–∞)
/grant_migration_confirm 30

# 6. –£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
/migrate_notify_confirm
```

---

## üìã –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∞ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏

### `/migrate_notify` ‚Äî –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–∞—Å—Å—ã–ª–∫–µ
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–º –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.

### `/migrate_notify_confirm` ‚Äî –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –ø–æ –ø–æ–ª—É—á–µ–Ω–∏—é –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞.

### `/grant_migration [days]` ‚Äî –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –≤—ã–¥–∞—á–µ –ø–æ–¥–ø–∏—Å–æ–∫
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –≤—ã–¥–∞—á–∏. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 30 –¥–Ω–µ–π.

### `/grant_migration_confirm [days]` ‚Äî –í—ã–¥–∞—á–∞ –ø–æ–¥–ø–∏—Å–æ–∫
–°–æ–∑–¥–∞—ë—Ç/–ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π.

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –õ–æ–≥–∏ –±–æ—Ç–∞
docker logs shftsecurebot-bot-1 --tail 100

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å UUID
sqlite3 data/bot_data.db "SELECT COUNT(*) FROM bot_users WHERE remnawave_user_uuid IS NOT NULL;"

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –Ω–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
curl -X GET "https://panel.new-domain.com/api/users?start=0&size=1" \
  -H "Authorization: Bearer $API_TOKEN" | jq '.response.totalCount'

# –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–∞
# –í –±–æ—Ç–µ: /start ‚Üí –ú–æ–π –¥–æ—Å—Ç—É–ø ‚Üí –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥
```

---

## üÜò –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞
docker compose down

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ë–î –∏–∑ –±—ç–∫–∞–ø–∞
cp data/bot_data.db.backup data/bot_data.db

# –í–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ä—ã–π .env
git checkout HEAD~1 -- .env

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
docker compose up -d
```

---

## üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–°–º–µ–Ω–∞ –¥–æ–º–µ–Ω–∞:** [DOMAIN_CHANGE_GUIDE.md](DOMAIN_CHANGE_GUIDE.md)
- **–ú–∏–≥—Ä–∞—Ü–∏—è –ø–∞–Ω–µ–ª–∏:** [PANEL_MIGRATION_GUIDE.md](PANEL_MIGRATION_GUIDE.md)
- **–°–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏:** [scripts/README.md](scripts/README.md)

---

**–£–¥–∞—á–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏!** üöÄ

